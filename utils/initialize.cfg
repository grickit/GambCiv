[event]
  name = start
  [chat]
    speaker = "CREDITS"
    message = "GambCiv was created by Gambit, with lots of help testing from friends.
Special thanks to all the GEB fans who kept insisting that it be made.
And thanks to you for playing. That you derive entertainment from this project makes the whole thing worthwhile!"
  [/chat]
  [chat]
    speaker = "HELP"
    message = "You can report bugs and get help at: http://grickit.github.com/gambciv/
There's also a thread on the Wesnoth forums: http://r.wesnoth.org/p505612"
  [/chat]
[/event]

[event]
  name = side turn 1
  first_time_only = no

  [store_side]
    side = $side_number
    variable = this_side
  [/store_side]
  {VARIABLE side_stats[$side_number].color $this_side.color}
  {CLEAR_VARIABLE this_side}

  [if]
    [have_unit]
      side = $side_number
      type = Peasant
      canrecruit = yes
    [/have_unit]
    [then]
      {VARIABLE side_stats[$side_number].controller "settler"}
      {VARIABLE side_stats[$side_number].citizens 5}
      {VARIABLE side_stats[$side_number].action_points 0}
      {VARIABLE side_stats[$side_number].food 10}
      {VARIABLE side_stats[$side_number].material 30}
    [/then]
  [/if]

  [if]
    [have_unit]
      side = $side_number
      type = Orcish Warlord
      canrecruit = yes
    [/have_unit]
    [then]
      {VARIABLE side_stats[$side_number].controller "barbarian"}
    [/then]
  [/if]

  [terrain]
    terrain="^"
    layer=overlay
    [and]
      terrain=*^V*
    [/and]
  [/terrain]

  [terrain]
    terrain="^"
    layer=overlay
    [and]
      terrain=*^Esd,*^Efm,*^Ewl,*^Edpp,*^Es,*^Esd,*^Ewf,*^Ewl,*Eff,*^Edp,*^Wm,*^li,*^Ufi
    [/and]
  [/terrain]

  [terrain]
    terrain="Gd^Gvs"
    layer=both
    [and]
      terrain=*^Gvs
    [/and]
  [/terrain]

  [terrain]
    terrain="Ww"
    layer=both
    [and]
      terrain=Wwf,Wwr,*^Bw*
    [/and]
  [/terrain]
[/event]

[event]
  name = side turn
  first_time_only = no

  [if]
    {VARCH side_stats[$side_number].controller equals "settler"}
    [then]
      {VARIABLE side_stats[$side_number].citizens 5}
      [store_locations]
	terrain="*^Vc"
	owner_side=$side_number
	variable=owned_huts
      [/store_locations]
      {FOREACH owned_huts i}
	{VARIABLE_OP side_stats[$side_number].citizens add "$(25/$side_stats[$side_number].citizens)"}
      {NEXT i}
      {CLEAR_VARIABLE owned_huts}

      [store_locations]
	terrain="*^Vh"
	owner_side=$side_number
	variable=owned_huts
      [/store_locations]
      {FOREACH owned_huts i}
	{VARIABLE_OP side_stats[$side_number].citizens add "$(25/$side_stats[$side_number].citizens)"}
	{VARIABLE_OP side_stats[$side_number].citizens add "$(25/$side_stats[$side_number].citizens)"}
      {NEXT i}
      {CLEAR_VARIABLE owned_huts}
      {VARIABLE side_stats[$side_number].action_points $side_stats[$side_number].citizens}
    [/then]
  [/if]

  {FOREACH just_modified i}
    [remove_item]
      x = $just_modified[$i].x
      y = $just_modified[$i].y
      image = "scenery/rune4-glow.png"
    [/remove_item]
  {NEXT i}
  {CLEAR_VARIABLE just_modified}
[/event]

[event]
  name = start
  [tunnel]
    id=train_track
    bidirectional = no
    [source]
      terrain = *^Br*
    [/source]
    [target]
      [and]
	x = $teleport_unit.x
	y = $teleport_unit.y
	radius = 200
	[filter_radius]
	  terrain = *^Br*
	  [not]
	    [filter]
	      [not]
		side = $side_number
	      [/not]
	      [not]
		level = 0
	      [/not]
	    [/filter]
	  [/not]
	[/filter_radius]
      [/and]
      terrain = *^Br*
    [/target]
    [filter]
    [/filter]
  [/tunnel]
[/event]

[event]
  name = prerecruit
  first_time_only = no
  [if]
    {VARCH side_stats[$side_number].controller equals "settler"}
    {VARCH turn_number greater_than 1}
    [then]
      [if]
	{VARCH side_stats[$side_number].action_points equals 0}
	[or]
	  {VARCH side_stats[$side_number].food equals 0}
	[/or]
	[then]
	  [gold]
	    side=$side_number
	    amount=$unit.cost
	  [/gold]
	  [kill]
	    x,y=$x1,$y1
	  [/kill]
	  {m_RESOURCES_ERROR 1 0 1 0}
	[/then]
	[else]
	  {VARIABLE_OP side_stats[$side_number].action_points add -1}
	  {VARIABLE_OP side_stats[$side_number].food add -1}
	[/else]
      [/if]
    [/then]
  [/if]
[/event]

[event]
  name = side turn
  first_time_only = yes
  [store_unit]
    [filter]
      side = $side_number
      canrecruit = yes
    [/filter]
    variable = player1
  [/store_unit]
  [message]
    speaker = narrator
    message = "Do you want to add bonus resources?"
    side_for = $side_number
      [option]
	  message = {MENU_IMG_TXT "items/gold-coins-small.png~SCALE(32,32)" "None"}
	[command]
	  {VARIABLE bonus_resources_string "no"}
	[/command]
      [/option]
      [option]
	  message = {MENU_IMG_TXT "items/gold-coins-medium.png~SCALE(32,32)" "Some"}
	[command]
	  {VARIABLE bonus_resources_string "some"}
	[/command]
      [/option]
      [option]
	  message = {MENU_IMG_TXT "items/gold-coins-large.png~SCALE(32,32)" "Lots"}
	[command]
	  {VARIABLE bonus_resources_string "a lot of"}
	[/command]
      [/option]
  [/message]
  [chat]
    speaker = "INFO"
    message = "$player1.name has chosen to add $bonus_resources_string bonus resources. You will get them next turn."
  [/chat]

  [message]
    speaker = narrator
    message = "Do you want to enable seasons?"
    side_for = $side_number
      [option]
	message = {MENU_IMG_TXT "misc/blank-hex.png~BLIT(terrain/grass/green.png~RC(000000>red)~SCALE(36,36),0,0)~BLIT(terrain/grass/dry.png~RC(000000>blue)~SCALE(36,36),0,36)~BLIT(terrain/frozen/snow.png~RC(000000>green)~SCALE(36,36),27,18)~SCALE(32,32)" "Yes"}
      [/option]
      [option]
	  message = {MENU_IMG_TXT "terrain/grass/green.png~SCALE(32,32)" "No"}
	[command]
	  {VARIABLE GambCiv_disable_seasons "yes"}
	  [chat]
	    speaker = "INFO"
	    message = "$player1.name has disabled seasons for this match."
	  [/chat]
	[/command]
      [/option]
  [/message]
  {CLEAR_VARIABLE player1}
[/event]

[event]
  name = side turn 2
  first_time_only = no
  [if]
    {VARCH side_stats[$side_number].controller equals "settler"}
    [then]
      [switch]
	variable = bonus_resources_string
	[case]
	  value = "some"
	  {VARIABLE_OP side_stats[$side_number].food add 10}
	  {VARIABLE_OP side_stats[$side_number].material add 30}
	  [gold]
	    side = $side_number
	    amount = 100
	  [/gold]
	  [chat]
	    speaker = "INFO"
	    message = "You have received a bonus of 100 gold, 10 food, and 30 material."
	    side = $side_number
	  [/chat]
	[/case]

	[case]
	  value = "a lot of"
	  {VARIABLE_OP side_stats[$side_number].food add 20}
	  {VARIABLE_OP side_stats[$side_number].material add 60}
	  [gold]
	    side = $side_number
	    amount = 200
	  [/gold]
	  [chat]
	    speaker = "INFO"
	    message = "You have received a bonus of 200 gold, 20 food, and 60 material."
	    side = $side_number
	  [/chat]
	[/case]
      [/switch]
    [/then]
  [/if]
  {CLEAR_VARIABLE bonus_resources_string}
[/event]
