[event]
  name = prestart

  [set_menu_item]
    id = da_shootunit
    description = _ "Shoot this unit"
    image = "buttons/group_obstacle.png"
    [show_if]
      [have_unit]
	x,y = $x1,$y1
	[not]
	  side = $side_number
	[/not]
      [/have_unit]
      [have_location]
	[and]
	  x,y = $x1,$y1
	  radius = 3
	[/and]
	terrain = "Ce^Vov"
	owner_side = $side_number
      [/have_location]
    [/show_if]
    [command]
      [store_locations]
	[and]
	  x,y = $x1,$y1
	  radius = 3
	[/and]
	terrain = "Ce^Vov"
	owner_side = $side_number
	[not]
	  find_in = just_modified
	[/not]
	variable = nearby_archery_towers
      [/store_locations]
      {VARIABLE message.speaker "narrator"}
      {VARIABLE message.message ( _ "You have: <span color=$s_ACTION_COLOR|>$side_stats[$side_number].action_points Actions</span> | <span color=$s_GOLD_COLOR|>$side_stats[$side_number].gold Gold</span> | <span color=$s_FOOD_COLOR|>$side_stats[$side_number].food Food</span> | <span color=$s_MATERIAL_COLOR|>$side_stats[$side_number].material Material</span>
Which tower should we use?")}
      {VARIABLE message.option[0].message ( _ "Nevermind.")}
      {FOREACH nearby_archery_towers i}
	{VARIABLE message.option["$($i+1)"].message {MENU_IMG_TXT "data/campaigns/Son_Of_The_Black_Eye/images/units/orcish-watch-tower.png~SCALE(36,36)~RC(magenta>$side_number].color)" ( _ "Archery tower at $nearby_archery_towers[$i].x,$nearby_archery_towers[$i].y")}}
	{VARIABLE message.option["$($i+1)"].command.sound.name "bow.ogg"}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.filter.x $x1}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.filter.y $y1}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.amount 12}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.alignment "lawful"}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.damage_type "pierce"}
	{VARIABLE message.option["$($i+1)"].command.store_locations.x $nearby_archery_towers[$i].x}
	{VARIABLE message.option["$($i+1)"].command.store_locations.y $nearby_archery_towers[$i].y}
	{VARIABLE message.option["$($i+1)"].command.store_locations.or.find_in just_modified}
	{VARIABLE message.option["$($i+1)"].command.store_locations.variable just_modified}
	{VARIABLE message.option["$($i+1)"].command.item.x $nearby_archery_towers[$i].x}
	{VARIABLE message.option["$($i+1)"].command.item.y $nearby_archery_towers[$i].y}
	{VARIABLE message.option["$($i+1)"].command.item.image "scenery/rune4-glow.png"}
	{VARIABLE message.option["$($i+1)"].command.scroll_to.x $nearby_archery_towers[$i].x}
	{VARIABLE message.option["$($i+1)"].command.scroll_to.y $nearby_archery_towers[$i].y}
	{VARIABLE message.option["$($i+1)"].command.scroll_to.check_fogged true}
      {NEXT i}
      [insert_tag]
	name = message
	variable = message
      [/insert_tag]
      {CLEAR_VARIABLE nearby_archery_towers}
      {CLEAR_VARIABLE message}
    [/command]
  [/set_menu_item]
[/event]